#=========================================================================
# WriteDataUnit_test
#=========================================================================

from pymtl3 import *
from pymtl3.stdlib.test_utils import run_test_vector_sim

from cache.WriteDataUnit import WriteDataUnit

#-------------------------------------------------------------------------
# test_len1
#-------------------------------------------------------------------------

def test_len1( cmdline_opts ):
  run_test_vector_sim( WriteDataUnit(), [
    ('in_                                    len offset wben*                  out*'                                 ),
    [ 0x00000000_00000000_00000000_00000000, 1,  0,     0b0000_0000_0000_0001, 0x00000000_00000000_00000000_00000000 ],

    [ 0x00000000_00000000_00000000_deadbeef, 1,  0,     0b0000_0000_0000_0001, 0x00000000_00000000_00000000_deadbeef ],
    [ 0x00000000_00000000_00000000_deadbeef, 1,  1,     0b0000_0000_0000_0010, 0x00000000_00000000_000000de_adbeef00 ],
    [ 0x00000000_00000000_00000000_deadbeef, 1,  2,     0b0000_0000_0000_0100, 0x00000000_00000000_0000dead_beef0000 ],
    [ 0x00000000_00000000_00000000_deadbeef, 1,  3,     0b0000_0000_0000_1000, 0x00000000_00000000_00deadbe_ef000000 ],

    [ 0x00000000_00000000_00000000_deadbeef, 1,  4,     0b0000_0000_0001_0000, 0x00000000_00000000_deadbeef_00000000 ],
    [ 0x00000000_00000000_00000000_deadbeef, 1,  5,     0b0000_0000_0010_0000, 0x00000000_000000de_adbeef00_00000000 ],
    [ 0x00000000_00000000_00000000_deadbeef, 1,  6,     0b0000_0000_0100_0000, 0x00000000_0000dead_beef0000_00000000 ],
    [ 0x00000000_00000000_00000000_deadbeef, 1,  7,     0b0000_0000_1000_0000, 0x00000000_00deadbe_ef000000_00000000 ],

    [ 0x00000000_00000000_00000000_deadbeef, 1,  8,     0b0000_0001_0000_0000, 0x00000000_deadbeef_00000000_00000000 ],
    [ 0x00000000_00000000_00000000_deadbeef, 1,  9,     0b0000_0010_0000_0000, 0x000000de_adbeef00_00000000_00000000 ],
    [ 0x00000000_00000000_00000000_deadbeef, 1,  10,    0b0000_0100_0000_0000, 0x0000dead_beef0000_00000000_00000000 ],
    [ 0x00000000_00000000_00000000_deadbeef, 1,  11,    0b0000_1000_0000_0000, 0x00deadbe_ef000000_00000000_00000000 ],

    [ 0x00000000_00000000_00000000_deadbeef, 1,  12,    0b0001_0000_0000_0000, 0xdeadbeef_00000000_00000000_00000000 ],
    [ 0x00000000_00000000_00000000_deadbeef, 1,  13,    0b0010_0000_0000_0000, 0xadbeef00_00000000_00000000_00000000 ],
    [ 0x00000000_00000000_00000000_deadbeef, 1,  14,    0b0100_0000_0000_0000, 0xbeef0000_00000000_00000000_00000000 ],
    [ 0x00000000_00000000_00000000_deadbeef, 1,  15,    0b1000_0000_0000_0000, 0xef000000_00000000_00000000_00000000 ],

  ], cmdline_opts )

#-------------------------------------------------------------------------
# test_len2
#-------------------------------------------------------------------------

def test_len2( cmdline_opts ):
  run_test_vector_sim( WriteDataUnit(), [
    ('in_                                    len offset wben*                  out*'                                 ),
    [ 0x00000000_00000000_00000000_00000000, 2,  0,     0b0000_0000_0000_0011, 0x00000000_00000000_00000000_00000000 ],

    [ 0x00000000_00000000_00000000_deadbeef, 2,  0,     0b0000_0000_0000_0011, 0x00000000_00000000_00000000_deadbeef ],
    [ 0x00000000_00000000_00000000_deadbeef, 2,  1,     0b0000_0000_0000_0110, 0x00000000_00000000_000000de_adbeef00 ],
    [ 0x00000000_00000000_00000000_deadbeef, 2,  2,     0b0000_0000_0000_1100, 0x00000000_00000000_0000dead_beef0000 ],
    [ 0x00000000_00000000_00000000_deadbeef, 2,  3,     0b0000_0000_0001_1000, 0x00000000_00000000_00deadbe_ef000000 ],

    [ 0x00000000_00000000_00000000_deadbeef, 2,  4,     0b0000_0000_0011_0000, 0x00000000_00000000_deadbeef_00000000 ],
    [ 0x00000000_00000000_00000000_deadbeef, 2,  5,     0b0000_0000_0110_0000, 0x00000000_000000de_adbeef00_00000000 ],
    [ 0x00000000_00000000_00000000_deadbeef, 2,  6,     0b0000_0000_1100_0000, 0x00000000_0000dead_beef0000_00000000 ],
    [ 0x00000000_00000000_00000000_deadbeef, 2,  7,     0b0000_0001_1000_0000, 0x00000000_00deadbe_ef000000_00000000 ],

    [ 0x00000000_00000000_00000000_deadbeef, 2,  8,     0b0000_0011_0000_0000, 0x00000000_deadbeef_00000000_00000000 ],
    [ 0x00000000_00000000_00000000_deadbeef, 2,  9,     0b0000_0110_0000_0000, 0x000000de_adbeef00_00000000_00000000 ],
    [ 0x00000000_00000000_00000000_deadbeef, 2,  10,    0b0000_1100_0000_0000, 0x0000dead_beef0000_00000000_00000000 ],
    [ 0x00000000_00000000_00000000_deadbeef, 2,  11,    0b0001_1000_0000_0000, 0x00deadbe_ef000000_00000000_00000000 ],

    [ 0x00000000_00000000_00000000_deadbeef, 2,  12,    0b0011_0000_0000_0000, 0xdeadbeef_00000000_00000000_00000000 ],
    [ 0x00000000_00000000_00000000_deadbeef, 2,  13,    0b0110_0000_0000_0000, 0xadbeef00_00000000_00000000_00000000 ],
    [ 0x00000000_00000000_00000000_deadbeef, 2,  14,    0b1100_0000_0000_0000, 0xbeef0000_00000000_00000000_00000000 ],

  ], cmdline_opts )

#-------------------------------------------------------------------------
# test_len4
#-------------------------------------------------------------------------

def test_len4( cmdline_opts ):
  run_test_vector_sim( WriteDataUnit(), [
    ('in_                                    len offset wben*                  out*'                                 ),
    [ 0x00000000_00000000_00000000_00000000, 4,  0,     0b0000_0000_0000_1111, 0x00000000_00000000_00000000_00000000 ],

    [ 0x00000000_00000000_00000000_deadbeef, 4,  0,     0b0000_0000_0000_1111, 0x00000000_00000000_00000000_deadbeef ],
    [ 0x00000000_00000000_00000000_deadbeef, 4,  1,     0b0000_0000_0001_1110, 0x00000000_00000000_000000de_adbeef00 ],
    [ 0x00000000_00000000_00000000_deadbeef, 4,  2,     0b0000_0000_0011_1100, 0x00000000_00000000_0000dead_beef0000 ],
    [ 0x00000000_00000000_00000000_deadbeef, 4,  3,     0b0000_0000_0111_1000, 0x00000000_00000000_00deadbe_ef000000 ],

    [ 0x00000000_00000000_00000000_deadbeef, 4,  4,     0b0000_0000_1111_0000, 0x00000000_00000000_deadbeef_00000000 ],
    [ 0x00000000_00000000_00000000_deadbeef, 4,  5,     0b0000_0001_1110_0000, 0x00000000_000000de_adbeef00_00000000 ],
    [ 0x00000000_00000000_00000000_deadbeef, 4,  6,     0b0000_0011_1100_0000, 0x00000000_0000dead_beef0000_00000000 ],
    [ 0x00000000_00000000_00000000_deadbeef, 4,  7,     0b0000_0111_1000_0000, 0x00000000_00deadbe_ef000000_00000000 ],

    [ 0x00000000_00000000_00000000_deadbeef, 4,  8,     0b0000_1111_0000_0000, 0x00000000_deadbeef_00000000_00000000 ],
    [ 0x00000000_00000000_00000000_deadbeef, 4,  9,     0b0001_1110_0000_0000, 0x000000de_adbeef00_00000000_00000000 ],
    [ 0x00000000_00000000_00000000_deadbeef, 4,  10,    0b0011_1100_0000_0000, 0x0000dead_beef0000_00000000_00000000 ],
    [ 0x00000000_00000000_00000000_deadbeef, 4,  11,    0b0111_1000_0000_0000, 0x00deadbe_ef000000_00000000_00000000 ],

    [ 0x00000000_00000000_00000000_deadbeef, 4,  12,    0b1111_0000_0000_0000, 0xdeadbeef_00000000_00000000_00000000 ],

  ], cmdline_opts )

#-------------------------------------------------------------------------
# test_len8
#-------------------------------------------------------------------------

def test_len8( cmdline_opts ):
  run_test_vector_sim( WriteDataUnit(), [
    ('in_                                    len offset wben*                  out*'                                 ),
    [ 0x00000000_00000000_00000000_00000000, 8,  0,     0b0000_0000_1111_1111, 0x00000000_00000000_00000000_00000000 ],

    [ 0xdeadbeef_cafeefac_c0ffee00_abcdef02, 8,  0,     0b0000_0000_1111_1111, 0xdeadbeef_cafeefac_c0ffee00_abcdef02 ],
    [ 0xdeadbeef_cafeefac_c0ffee00_abcdef02, 8,  1,     0b0000_0001_1111_1110, 0xadbeefca_feefacc0_ffee00ab_cdef0200 ],
    [ 0xdeadbeef_cafeefac_c0ffee00_abcdef02, 8,  2,     0b0000_0011_1111_1100, 0xbeefcafe_efacc0ff_ee00abcd_ef020000 ],
    [ 0xdeadbeef_cafeefac_c0ffee00_abcdef02, 8,  3,     0b0000_0111_1111_1000, 0xefcafeef_acc0ffee_00abcdef_02000000 ],

    [ 0xdeadbeef_cafeefac_c0ffee00_abcdef02, 8,  4,     0b0000_1111_1111_0000, 0xcafeefac_c0ffee00_abcdef02_00000000 ],
    [ 0xdeadbeef_cafeefac_c0ffee00_abcdef02, 8,  5,     0b0001_1111_1110_0000, 0xfeefacc0_ffee00ab_cdef0200_00000000 ],
    [ 0xdeadbeef_cafeefac_c0ffee00_abcdef02, 8,  6,     0b0011_1111_1100_0000, 0xefacc0ff_ee00abcd_ef020000_00000000 ],
    [ 0xdeadbeef_cafeefac_c0ffee00_abcdef02, 8,  7,     0b0111_1111_1000_0000, 0xacc0ffee_00abcdef_02000000_00000000 ],

    [ 0xdeadbeef_cafeefac_c0ffee00_abcdef02, 8,  8,     0b1111_1111_0000_0000, 0xc0ffee00_abcdef02_00000000_00000000 ],

  ], cmdline_opts )

#-------------------------------------------------------------------------
# test_len0
#-------------------------------------------------------------------------

def test_len0( cmdline_opts ):
  run_test_vector_sim( WriteDataUnit(), [
    ('in_                                    len offset wben*                  out*'                                 ),
    [ 0x00000000_00000000_00000000_00000000, 0,  0,     0b1111_1111_1111_1111, 0x00000000_00000000_00000000_00000000 ],
    [ 0xdeadbeef_cafeefac_c0ffee00_abcdef02, 0,  0,     0b1111_1111_1111_1111, 0xdeadbeef_cafeefac_c0ffee00_abcdef02 ],
  ], cmdline_opts )

